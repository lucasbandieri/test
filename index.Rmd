---
title: "COVID-19"
output: 
  flexdashboard::flex_dashboard:
    #social: menu
    orientation: rows
    social: ["facebook", "twitter"]
    vertical_layout: scroll #fill
    logo: logo - CENPAT_48x60.png
    favicon: logo - CENPAT_48x60.png

---
<style>                     
.navbar {
  background-color: #0b335e;
  border-color:black;
}
.navbar-brand {
color:white!important;
}
</style>  





```{r setup, include=FALSE}
#------------------ Packages ------------------
library(flexdashboard)
library(shiny)
library(gsheet)
library(tidyr)
library(plotly)
library(maptools)
library(leaflet)
library(htmltools)
library(htmlwidgets)
library(rbokeh) # In this dashboard we are using a new visualization package in R, called 'rbokeh'!
library(icon)

# install.packages("devtools")                                                    navbar:      - { title: "Ministerio", href: "https://example.com/about", align: right }
# devtools::install_github("RamiKrispin/coronavirus", force = TRUE)
# library(coronavirus)
# data(coronavirus)
# update_datasets()

# View(coronavirus)
# max(coronavirus$date)

`%>%` <- magrittr::`%>%`
#------------------ Parameters ------------------
# Set colors
# https://www.w3.org/TR/css-color-3/#svg-color
confirmed_color <-   "#D55E00"#"purple"
active_color <- "#0072B2"#"#1f77b4"
recovered_color <- "#009E73"#"forestgreen"
death_color <-  "#D53E4F" #"red"




# library(RColorBrewer)
# display.brewer.all(n = 5, type = "div", select = NULL, colorblindFriendly = FALSE)

#------------------ Data ------------------

#install.packages('gsheet')

#### iconos: https://fontawesome.com/icons?d=gallery&m=free
totales_País <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1GYOS5gXpVJJZ42A5UhJHJa0_WVRTsAznJ0LCqt5i-Z8/edit?usp=sharing')

totales_País$Fecha <- as.Date(totales_País$Fecha, format = "%d/%m/%Y")

totales_País_mas_reciente <-totales_País %>% 
  dplyr::filter(Fecha == max(Fecha))


### Función para calcular la media móvil de un vector de números
## Autor: Julio Lancelotti
## Última actualización 32-7-2017
## Parámetros:
## x: un vector numérico
## ventana: tamaño de la ventana para calcular la media móvil. Para cada valor de x se calcula el valor medio (no pesado) para valores anteriores (x-ventana/2) y posteriores (x + ventana/2) a su posición en x. En los extremos de x (inicio y fin de la serie de datos), la ventana se ajusta automáticamente al rango de valores de x disponibles.


runmean <- function(x, ventana= 20){
  vr <- x
  rnmn <- rep( NA, length(x) )
  
  for (k in 1:length(vr)){
    rnmn[k] = ifelse(k <= ventana/2, mean(vr[1:(k + ventana/2)]),
                     ifelse( (k + ventana/2)>= length(vr),
                             mean(vr[(k - ventana/2):length(vr)]),
                             mean(vr[(k - ventana/2):(k + ventana/2)]) )
    )
  } # fin calculo media movil
  rnmn
} ## Fin función

totales_País$media_movil_casos_dia <-  runmean(totales_País$NuevosCasosDia, ventana = 5)




fallecidos_Pais <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1vYis6Ts7mQqTY_LtB02L7B6NXDU5kFVhthhg3txrsS8/edit?usp=sharing")
fallecidos_Pais[fallecidos_Pais$Edad==9999, "Edad"] <- NA
fallecidos_Pais[fallecidos_Pais$Sexo=="unk", "Sexo"] <- NA

fallecidos_Pais_resumen <- data.frame("Rango_edad" = rep(c("0 a 9","10 a 19","20 a 29","30 a 39", "40 a 49", "50 a 59", "60 a 69", "70 a 79", "80 a 89", "90 a 99", "100+"), 2), "Rango_edad_min" = rep(seq(0,100,10),2), "Rango_edad_max" = rep(seq(10,110,10),2),"Sexo"= c(rep("hombre",11), rep("mujer",11)))

for (i in 1:nrow(fallecidos_Pais_resumen)) {
  fallecidos_Pais_resumen[i,"Cantidad"] <- nrow(na.omit(fallecidos_Pais[fallecidos_Pais$Edad>=fallecidos_Pais_resumen[i,"Rango_edad_min"] & fallecidos_Pais$Edad<=fallecidos_Pais_resumen[i,"Rango_edad_max"] & fallecidos_Pais$Sexo==fallecidos_Pais_resumen[i,"Sexo"],"Fecha"]))  
}



fallecidos_Pais_resumen_transp  <- spread(fallecidos_Pais_resumen, Sexo, Cantidad)

resumenes_diarios_prov_Pat <- gsheet2tbl("https://docs.google.com/spreadsheets/d/18TKGtQ8IrXIKz-zcB1QiT4FzXokKfG3XyQbCxvkO-5w/edit?usp=sharing")
resumenes_diarios_prov_Pat$Fecha <- as.Date(resumenes_diarios_prov_Pat$Fecha, format="%d/%m/%y")
resumenes_diarios_prov_Pat$Fecha_esp <- format(resumenes_diarios_prov_Pat$Fecha, "%d/%m/%Y")

resumenes_diarios_prov_Pat <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia != "La Pampa",] #### quito La Pampla

resumenes_diarios_prov_Pat$Ultima_act <- paste(resumenes_diarios_prov_Pat$Fecha_esp, resumenes_diarios_prov_Pat$Hora_informe, sep = " - ")

# ultimo_resumen_La_Pampa <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="La Pampa",]
# ultimo_resumen_La_Pampa <- ultimo_resumen_La_Pampa[ultimo_resumen_La_Pampa$Fecha == max(ultimo_resumen_La_Pampa$Fecha),]

ultimo_resumen_Neuquen <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Neuquén",]
ultimo_resumen_Neuquen <- ultimo_resumen_Neuquen[ultimo_resumen_Neuquen$Fecha == max(ultimo_resumen_Neuquen$Fecha),]

ultimo_resumen_Río_Negro <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Río Negro",]
ultimo_resumen_Río_Negro <- ultimo_resumen_Río_Negro[ultimo_resumen_Río_Negro$Fecha == max(ultimo_resumen_Río_Negro$Fecha),]

ultimo_resumen_Chubut <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Chubut",]
ultimo_resumen_Chubut <- ultimo_resumen_Chubut[ultimo_resumen_Chubut$Fecha == max(ultimo_resumen_Chubut$Fecha),]


ultimo_resumen_Santa_Cruz <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Santa Cruz",]
ultimo_resumen_Santa_Cruz <- ultimo_resumen_Santa_Cruz[ultimo_resumen_Santa_Cruz$Fecha == max(ultimo_resumen_Santa_Cruz$Fecha),]

ultimo_resumen_Tierra_del_Fuego <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Tierra del Fuego y Malvinas",]
ultimo_resumen_Tierra_del_Fuego <- ultimo_resumen_Tierra_del_Fuego[ultimo_resumen_Tierra_del_Fuego$Fecha == max(ultimo_resumen_Tierra_del_Fuego$Fecha),]




informes_Rio_Negro_sumatoria_diaria <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Río Negro",]
informes_Rio_Negro_sumatoria_diaria$LN_confirmados_acum <- log(informes_Rio_Negro_sumatoria_diaria$Confirmados_acum)

informes_Rio_Negro_sumatoria_diaria$Tiempo_duplicación = 0
informes_Rio_Negro_sumatoria_diaria$IC_Tiempo_duplicación_superior = 0
informes_Rio_Negro_sumatoria_diaria$IC_Tiempo_duplicación_inferior = 0

alpha_2 = 0.05
T = qt((1-alpha_2/2), 5)


#### SI(O(SUMA(B13:B15)=0;O8<=0,7);"Este indicador NO se puede utilizar ";"Este indicador se puede utilizar") 
for (i in nrow(informes_Rio_Negro_sumatoria_diaria):nrow(informes_Rio_Negro_sumatoria_diaria)) { #### sólo lo calculo para el último día
  
  if (informes_Rio_Negro_sumatoria_diaria[i,"Confirmados_acum"]< 50 | (informes_Rio_Negro_sumatoria_diaria[i,"Confirmados_acum"]-informes_Rio_Negro_sumatoria_diaria[(i-3),"Confirmados_acum"])==0) {
    
    informes_Rio_Negro_sumatoria_diaria[i, "Tiempo_duplicación"] <- NA
    informes_Rio_Negro_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <- NA
    informes_Rio_Negro_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <- NA
    informes_Rio_Negro_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- c("Este indicador NO se puede utilizar")
  } else {
    
    modelo_lineal <- lm(LN_confirmados_acum ~ Fecha, data = informes_Rio_Negro_sumatoria_diaria[(i-6):i,])
  
    pendiente <- summary(modelo_lineal)$coefficients[2,1]
  
    informes_Rio_Negro_sumatoria_diaria[i, "Tiempo_duplicación"] <-  log(2)/pendiente
  
    error_pendiente = summary(modelo_lineal)$coefficients[2,2]
  
    IC_superior <- pendiente-(T*error_pendiente)
  
    IC_inferior <- pendiente+(T*error_pendiente) 
  
    informes_Rio_Negro_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <-  log(2)/IC_superior
  
    informes_Rio_Negro_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <-  log(2)/IC_inferior
    
    
    informes_Rio_Negro_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- ifelse(summary(modelo_lineal)$r.squared<=0.7, "Este indicador NO se puede utilizar", "Este indicador se puede utilizar")
    }
}


tiempo_duplicacion_Rio_Negro <- informes_Rio_Negro_sumatoria_diaria[nrow(informes_Rio_Negro_sumatoria_diaria), "Tiempo_duplicación"]




informes_Neuquen_sumatoria_diaria <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Neuquén",]
informes_Neuquen_sumatoria_diaria$LN_confirmados_acum <- log(informes_Neuquen_sumatoria_diaria$Confirmados_acum)

informes_Neuquen_sumatoria_diaria$Tiempo_duplicación = 0
informes_Neuquen_sumatoria_diaria$IC_Tiempo_duplicación_superior = 0
informes_Neuquen_sumatoria_diaria$IC_Tiempo_duplicación_inferior = 0

alpha_2 = 0.05
T = qt((1-alpha_2/2), 5)


#### SI(O(SUMA(B13:B15)=0;O8<=0,7);"Este indicador NO se puede utilizar ";"Este indicador se puede utilizar") 
for (i in (nrow(informes_Neuquen_sumatoria_diaria)-1):nrow(informes_Neuquen_sumatoria_diaria)) { #### sólo lo calculo para el último día
  
  if (informes_Neuquen_sumatoria_diaria[i,"Confirmados_acum"]< 50 | (informes_Neuquen_sumatoria_diaria[i,"Confirmados_acum"]-informes_Neuquen_sumatoria_diaria[(i-3),"Confirmados_acum"])==0) {
    
    informes_Neuquen_sumatoria_diaria[i, "Tiempo_duplicación"] <- NA
    informes_Neuquen_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <- NA
    informes_Neuquen_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <- NA
    informes_Neuquen_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- c("Este indicador NO se puede utilizar")
  } else {
    
    modelo_lineal <- lm(LN_confirmados_acum ~ Fecha, data = informes_Neuquen_sumatoria_diaria[(i-6):i,])
  
    pendiente <- summary(modelo_lineal)$coefficients[2,1]
  
    informes_Neuquen_sumatoria_diaria[i, "Tiempo_duplicación"] <-  log(2)/pendiente
  
    error_pendiente = summary(modelo_lineal)$coefficients[2,2]
  
    IC_superior <- pendiente-(T*error_pendiente)
  
    IC_inferior <- pendiente+(T*error_pendiente) 
  
    informes_Neuquen_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <-  log(2)/IC_superior
  
    informes_Neuquen_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <-  log(2)/IC_inferior
    
    
    informes_Neuquen_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- ifelse(summary(modelo_lineal)$r.squared<=0.7, "Este indicador NO se puede utilizar", "Este indicador se puede utilizar")
    }
}

tiempo_duplicacion_Neuquen <- ifelse(informes_Neuquen_sumatoria_diaria[nrow(informes_Neuquen_sumatoria_diaria), "Hora_informe"] <= 20:00,
                                    informes_Neuquen_sumatoria_diaria[(nrow(informes_Neuquen_sumatoria_diaria)-1), "Tiempo_duplicación"],
                                    informes_Neuquen_sumatoria_diaria[nrow(informes_Neuquen_sumatoria_diaria), "Tiempo_duplicación"])






informes_SantaCruz_sumatoria_diaria <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Santa Cruz",]
informes_SantaCruz_sumatoria_diaria$LN_confirmados_acum <- log(informes_SantaCruz_sumatoria_diaria$Confirmados_acum)

informes_SantaCruz_sumatoria_diaria$Tiempo_duplicación = 0
informes_SantaCruz_sumatoria_diaria$IC_Tiempo_duplicación_superior = 0
informes_SantaCruz_sumatoria_diaria$IC_Tiempo_duplicación_inferior = 0

alpha_2 = 0.05
T = qt((1-alpha_2/2), 5)


#### SI(O(SUMA(B13:B15)=0;O8<=0,7);"Este indicador NO se puede utilizar ";"Este indicador se puede utilizar") 
for (i in (nrow(informes_SantaCruz_sumatoria_diaria)-1):nrow(informes_SantaCruz_sumatoria_diaria)) { #### sólo lo calculo para el último día
  
  if (informes_SantaCruz_sumatoria_diaria[i,"Confirmados_acum"]< 50 | (informes_SantaCruz_sumatoria_diaria[i,"Confirmados_acum"]-informes_SantaCruz_sumatoria_diaria[(i-3),"Confirmados_acum"])==0) {
    
    informes_SantaCruz_sumatoria_diaria[i, "Tiempo_duplicación"] <- NA
    informes_SantaCruz_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <- NA
    informes_SantaCruz_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <- NA
    informes_SantaCruz_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- c("Este indicador NO se puede utilizar")
  } else {
    
    modelo_lineal <- lm(LN_confirmados_acum ~ Fecha, data = informes_SantaCruz_sumatoria_diaria[(i-6):i,])
  
    pendiente <- summary(modelo_lineal)$coefficients[2,1]
  
    informes_SantaCruz_sumatoria_diaria[i, "Tiempo_duplicación"] <-  log(2)/pendiente
  
    error_pendiente = summary(modelo_lineal)$coefficients[2,2]
  
    IC_superior <- pendiente-(T*error_pendiente)
  
    IC_inferior <- pendiente+(T*error_pendiente) 
  
    informes_SantaCruz_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <-  log(2)/IC_superior
  
    informes_SantaCruz_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <-  log(2)/IC_inferior
    
    
    informes_SantaCruz_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- ifelse(summary(modelo_lineal)$r.squared<=0.7, "Este indicador NO se puede utilizar", "Este indicador se puede utilizar")
    }
}

tiempo_duplicacion_SantaCruz <- ifelse(informes_SantaCruz_sumatoria_diaria[nrow(informes_SantaCruz_sumatoria_diaria), "Hora_informe"] <= 18:00,
                                    informes_SantaCruz_sumatoria_diaria[(nrow(informes_SantaCruz_sumatoria_diaria)-1), "Tiempo_duplicación"],
                                    informes_SantaCruz_sumatoria_diaria[nrow(informes_SantaCruz_sumatoria_diaria), "Tiempo_duplicación"])





informes_TierraDelFuego_sumatoria_diaria <- resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Tierra del Fuego y Malvinas",]
informes_TierraDelFuego_sumatoria_diaria$LN_confirmados_acum <- log(informes_TierraDelFuego_sumatoria_diaria$Confirmados_acum)

informes_TierraDelFuego_sumatoria_diaria$Tiempo_duplicación = 0
informes_TierraDelFuego_sumatoria_diaria$IC_Tiempo_duplicación_superior = 0
informes_TierraDelFuego_sumatoria_diaria$IC_Tiempo_duplicación_inferior = 0

alpha_2 = 0.05
T = qt((1-alpha_2/2), 5)


#### SI(O(SUMA(B13:B15)=0;O8<=0,7);"Este indicador NO se puede utilizar ";"Este indicador se puede utilizar") 
for (i in (nrow(informes_TierraDelFuego_sumatoria_diaria)-1):nrow(informes_TierraDelFuego_sumatoria_diaria)) { #### sólo lo calculo para el último día
  
  if (informes_TierraDelFuego_sumatoria_diaria[i,"Confirmados_acum"]< 50 | (informes_TierraDelFuego_sumatoria_diaria[i,"Confirmados_acum"]-informes_TierraDelFuego_sumatoria_diaria[(i-3),"Confirmados_acum"])==0) {
    
    informes_TierraDelFuego_sumatoria_diaria[i, "Tiempo_duplicación"] <- NA
    informes_TierraDelFuego_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <- NA
    informes_TierraDelFuego_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <- NA
    informes_TierraDelFuego_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- c("Este indicador NO se puede utilizar")
  } else {
    
    modelo_lineal <- lm(LN_confirmados_acum ~ Fecha, data = informes_TierraDelFuego_sumatoria_diaria[(i-6):i,])
  
    pendiente <- summary(modelo_lineal)$coefficients[2,1]
  
    informes_TierraDelFuego_sumatoria_diaria[i, "Tiempo_duplicación"] <-  log(2)/pendiente
  
    error_pendiente = summary(modelo_lineal)$coefficients[2,2]
  
    IC_superior <- pendiente-(T*error_pendiente)
  
    IC_inferior <- pendiente+(T*error_pendiente) 
  
    informes_TierraDelFuego_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <-  log(2)/IC_superior
  
    informes_TierraDelFuego_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <-  log(2)/IC_inferior
    
    
    informes_TierraDelFuego_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- ifelse(summary(modelo_lineal)$r.squared<=0.7, "Este indicador NO se puede utilizar", "Este indicador se puede utilizar")
    }
}

tiempo_duplicacion_TierraDelFuego <- ifelse(informes_TierraDelFuego_sumatoria_diaria[nrow(informes_TierraDelFuego_sumatoria_diaria), "Hora_informe"] <= 18:00,
                                    informes_TierraDelFuego_sumatoria_diaria[(nrow(informes_TierraDelFuego_sumatoria_diaria)-1), "Tiempo_duplicación"],
                                    informes_TierraDelFuego_sumatoria_diaria[nrow(informes_TierraDelFuego_sumatoria_diaria), "Tiempo_duplicación"])

# informes_La_Pampa <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1qBMHjsz5BhzM-rQS3sqRtfzOAuwLHC4gO7Fe9SsBnjA/edit?usp=sharing")
# informes_La_Pampa$Fecha <- as.Date(informes_La_Pampa$Fecha, format="%d/%m/%y")
# informes_La_Pampa$Fecha_esp <- format(informes_La_Pampa$Fecha, "%d/%m/%Y")
# informes_La_Pampa_mas_reciente  <- informes_La_Pampa %>% 
#   dplyr::filter(Fecha == max(Fecha))
# 
# informes_La_Pampa_mas_reciente$Texto <- with(informes_La_Pampa_mas_reciente, paste0('<p>', informes_La_Pampa_mas_reciente$Localidad,'<p></p>',
#                                         '<p>',"Confirmados: ", informes_La_Pampa_mas_reciente$Confirmados,  '<p></p>', "Casos sospechosos: ", informes_La_Pampa_mas_reciente$Sospechosos,  '</p>',
#                                         '<p>',"Activos: ", informes_La_Pampa_mas_reciente$Activos, '<p></p>',"Fallecidos: ", informes_La_Pampa_mas_reciente$Fallecidos,  '</p>', 
#                                         '<p></p>',"Fecha: ", informes_La_Pampa_mas_reciente$Fecha_esp,  '</p>'))

informes_Neuquen <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1-o35nRs1MWyZVV1FMl0EwpuHxT222bXakxwvnGIRHW0/edit?usp=sharing")
informes_Neuquen$Fecha <- as.Date(informes_Neuquen$Fecha, format="%d/%m/%y")
informes_Neuquen$Fecha_esp <- format(informes_Neuquen$Fecha, "%d/%m/%Y")
informes_Neuquen_mas_reciente  <- informes_Neuquen %>% 
  dplyr::filter(Fecha == max(Fecha))
informes_Neuquen_mas_reciente$Provincia <- c("Neuquén")

informes_Neuquen_mas_reciente$Texto <- with(informes_Neuquen_mas_reciente, paste0('<p>', paste0(informes_Neuquen_mas_reciente$Localidad," (", informes_Neuquen_mas_reciente$Provincia, ")") ,'<p></p>',
                                                                                  '<p>',"Confirmados: ", informes_Neuquen_mas_reciente$Confirmados,  '<p></p>', "Casos sospechosos: ", informes_Neuquen_mas_reciente$Sospechosos,  '</p>',
                                                                                  '<p>',"Activos: ", informes_Neuquen_mas_reciente$Activos, '<p></p>',"Fallecidos: ", informes_Neuquen_mas_reciente$Fallecidos,  '</p>',
                                                                                  '<p></p>',"Fecha: ", informes_Neuquen_mas_reciente$Fecha_esp,  '</p>'))



informes_Santa_Cruz <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1BdpV7443KaCQjVNWhW69GVdiOGk5Ggc3g3J4-Y7fBkg/edit?usp=sharing")
informes_Santa_Cruz$Fecha <- as.Date(informes_Santa_Cruz$Fecha, format="%d/%m/%y")
informes_Santa_Cruz$Fecha_esp <- format(informes_Santa_Cruz$Fecha, "%d/%m/%Y")
informes_Santa_Cruz_mas_reciente  <- informes_Santa_Cruz %>% 
  dplyr::filter(Fecha == max(Fecha))

informes_Santa_Cruz_mas_reciente$Provincia <- c("Santa Cruz")
informes_Santa_Cruz_mas_reciente$Texto <- with(informes_Santa_Cruz_mas_reciente, paste0('<p>', paste0(informes_Santa_Cruz_mas_reciente$Localidad," (", informes_Santa_Cruz_mas_reciente$Provincia, ")") ,'<p></p>',
                                                                                        '<p>',"Confirmados: ", informes_Santa_Cruz_mas_reciente$Confirmados,  '<p></p>', "Casos sospechosos: ", informes_Santa_Cruz_mas_reciente$Sospechosos,  '</p>',
                                                                                        '<p>',"Activos: ", informes_Santa_Cruz_mas_reciente$Activos, '<p></p>',"Fallecidos: ", informes_Santa_Cruz_mas_reciente$Fallecidos,  '</p>', 
                                                                                        '<p></p>',"Fecha: ", informes_Santa_Cruz_mas_reciente$Fecha_esp,  '</p>'))


informes_Tierra_del_Fuego <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1VuyGpjw7XsHTfA0XSsmJBC-fuZ8o5WR0g-Lyy8skG10/edit?usp=sharing")
informes_Tierra_del_Fuego$Fecha <- as.Date(informes_Tierra_del_Fuego$Fecha, format="%d/%m/%y")
informes_Tierra_del_Fuego$Fecha_esp <- format(informes_Tierra_del_Fuego$Fecha, "%d/%m/%Y")
informes_Tierra_del_Fuego_mas_reciente  <- informes_Tierra_del_Fuego %>% 
  dplyr::filter(Fecha == max(Fecha))

informes_Tierra_del_Fuego_mas_reciente$Provincia <- c("Tierra del Fuego")
informes_Tierra_del_Fuego_mas_reciente$Confirmados <- informes_Tierra_del_Fuego_mas_reciente$Confirmados_acum
informes_Tierra_del_Fuego_mas_reciente$Texto <- with(informes_Tierra_del_Fuego_mas_reciente, paste0('<p>',paste0(informes_Tierra_del_Fuego_mas_reciente$Localidad," (", informes_Tierra_del_Fuego_mas_reciente$Provincia, ")") ,'<p></p>',
                                                                                                    '<p>',"Confirmados: ", informes_Tierra_del_Fuego_mas_reciente$Confirmados_acum,  '<p></p>', "Casos sospechosos: ", informes_Tierra_del_Fuego_mas_reciente$Sospechosos,  '</p>',
                                                                                                    '<p>',"Activos: ", informes_Tierra_del_Fuego_mas_reciente$Activos, '<p></p>',"Fallecidos: ", informes_Tierra_del_Fuego_mas_reciente$Fallecidos,  '</p>', 
                                                                                                    '<p></p>',"Fecha: ", informes_Tierra_del_Fuego_mas_reciente$Fecha_esp,  '</p>'))



informes_Rio_Negro <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1tA3ehKbp2BZKJZG-cgRijrZCjVla5NUbgcx9MTc3rkU/edit?usp=sharing")
informes_Rio_Negro$Fecha <- as.Date(informes_Rio_Negro$Fecha, format="%d/%m/%y")
informes_Rio_Negro$Fecha_esp <- format(informes_Rio_Negro$Fecha, "%d/%m/%Y")









informes_Rio_Negro_mas_reciente  <- informes_Rio_Negro %>% 
  dplyr::filter(Fecha == max(Fecha))

informes_Rio_Negro_mas_reciente$Provincia <- c("Río Negro")
informes_Rio_Negro_mas_reciente$Texto <- with(informes_Rio_Negro_mas_reciente, paste0('<p>', paste0(informes_Rio_Negro_mas_reciente$Localidad," (", informes_Rio_Negro_mas_reciente$Provincia, ")") ,'<p></p>',
                                                                                      '<p>',"Confirmados: ", informes_Rio_Negro_mas_reciente$Confirmados,  '<p></p>', 
                                                                                      '<p>',"Activos: ", informes_Rio_Negro_mas_reciente$Activos, '<p></p>',"Fallecidos: ", informes_Rio_Negro_mas_reciente$Fallecidos_acum,  '</p>', 
                                                                                      '<p></p>',"Fecha: ", informes_Rio_Negro_mas_reciente$Fecha_esp,  '</p>'))


#informes_Rio_Negro_mas_reciente_transp  <- gather(informes_Rio_Negro_mas_reciente, Clase, Conteo, -Localidad, -Long, -Lat, -Fecha, -Obs, -'Activos', -'Fallecidos', -'Sospechosos')

informes_Chubut <- gsheet2tbl('https://docs.google.com/spreadsheets/d/1b3NYFb2I9dUyJXmC6OucDTOpns4FQPWGaNt66opjw-A/edit?usp=sharing')

informes_Chubut$Fecha <- as.Date(informes_Chubut$Fecha, format="%d/%m/%Y")
informes_Chubut$Fecha_español <- format.Date(informes_Chubut$Fecha, "%d %b %Y", locale=locale("es"))

informes_Chubut$confirmados_acum <- informes_Chubut$`Casos Confirmados`
informes_Chubut$muertos_acum <- informes_Chubut$`Muertes`

informes_Chubut_sumatoria_diaria <- informes_Chubut %>% # Start by defining the original dataframe, AND THEN...
  group_by(Fecha) %>% # Define the grouping variable, AND THEN...
  summarise( # Now you define your summary variables with a name and a function...
    # Observations = n(),  ## The function n() in dlpyr gives you the number of observations
    confirmados_acum = sum(`Casos Confirmados`),
    muertos_acum = sum(`Muertes`)
  )

informes_Chubut_sumatoria_diaria$LN_confirmados_acum <- log(informes_Chubut_sumatoria_diaria$confirmados_acum)

informes_Chubut_sumatoria_diaria$Tiempo_duplicación = 0
informes_Chubut_sumatoria_diaria$IC_Tiempo_duplicación_superior = 0
informes_Chubut_sumatoria_diaria$IC_Tiempo_duplicación_inferior = 0

alpha_2 = 0.05
T = qt((1-alpha_2/2), 5)


#### SI(O(SUMA(B13:B15)=0;O8<=0,7);"Este indicador NO se puede utilizar ";"Este indicador se puede utilizar") 
for (i in nrow(informes_Chubut_sumatoria_diaria):nrow(informes_Chubut_sumatoria_diaria)) { #### sólo lo calculo para el último día
  
  if (informes_Chubut_sumatoria_diaria[i,"confirmados_acum"]< 50 | (informes_Chubut_sumatoria_diaria[i,"confirmados_acum"]-informes_Chubut_sumatoria_diaria[(i-3),"confirmados_acum"])==0) {
    
    informes_Chubut_sumatoria_diaria[i, "Tiempo_duplicación"] <- NA
    informes_Chubut_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <- NA
    informes_Chubut_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <- NA
    informes_Chubut_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- c("Este indicador NO se puede utilizar")
  } else {
    
    modelo_lineal <- lm(LN_confirmados_acum ~ Fecha, data = informes_Chubut_sumatoria_diaria[(i-6):i,])
  
    pendiente <- summary(modelo_lineal)$coefficients[2,1]
  
    informes_Chubut_sumatoria_diaria[i, "Tiempo_duplicación"] <-  log(2)/pendiente
  
    error_pendiente = summary(modelo_lineal)$coefficients[2,2]
  
    IC_superior <- pendiente-(T*error_pendiente)
  
    IC_inferior <- pendiente+(T*error_pendiente) 
  
    informes_Chubut_sumatoria_diaria[i, "IC_Tiempo_duplicación_superior"] <-  log(2)/IC_superior
  
    informes_Chubut_sumatoria_diaria[i, "IC_Tiempo_duplicación_inferior"] <-  log(2)/IC_inferior
    
    
    informes_Chubut_sumatoria_diaria[i, "Tiempo_duplicación_recomendado"] <- ifelse(summary(modelo_lineal)$r.squared<=0.7, "Este indicador NO se puede utilizar", "Este indicador se puede utilizar")
    }
}


tiempo_duplicacion_Chubut <- informes_Chubut_sumatoria_diaria[nrow(informes_Chubut_sumatoria_diaria), "Tiempo_duplicación"]


informes_Chubut_mas_reciente  <- informes_Chubut %>% 
  dplyr::filter(Fecha == max(Fecha))




informes_Chubut_por_localidad <- gsheet2tbl("https://docs.google.com/spreadsheets/d/10VaFHeLgUlV26BDZe5_xnt1alzK-dz2XDyDZuocST0A/edit?usp=sharing")
informes_Chubut_por_localidad$Fecha <- as.Date(informes_Chubut_por_localidad$Fecha, format="%d/%m/%y")
informes_Chubut_por_localidad$Fecha_esp <- format(informes_Chubut_por_localidad$Fecha, "%d/%m/%Y")

informes_Chubut_por_localidad_mas_reciente  <- informes_Chubut_por_localidad %>% 
  dplyr::filter(Fecha == max(Fecha))

informes_Chubut_por_localidad_mas_reciente$Provincia <- c("Chubut")
informes_Chubut_por_localidad_mas_reciente$Texto <- with(informes_Chubut_por_localidad_mas_reciente, paste0('<p>', paste0(informes_Chubut_por_localidad_mas_reciente$Localidad," (", informes_Chubut_por_localidad_mas_reciente$Provincia, ")") ,'<p></p>',
                                                                                                            '<p>',"Confirmados: ", informes_Chubut_por_localidad_mas_reciente$Confirmados,  '<p></p>', 
                                                                                                            '<p>',"Activos: ", informes_Chubut_por_localidad_mas_reciente$Activos, '<p></p>',
                                                                                                            "Fallecidos: ", informes_Chubut_por_localidad_mas_reciente$Fallecidos_acum,  '</p>', 
                                                                                                            "Fecha: ", informes_Chubut_por_localidad_mas_reciente$Fecha_esp,  '</p>'))

localidades <- rbind(informes_Chubut_por_localidad_mas_reciente[,c("Long", "Lat", "Fecha_esp", "Confirmados", "Activos", "Texto")],
                       informes_Santa_Cruz_mas_reciente[,c("Long", "Lat", "Fecha_esp", "Confirmados", "Activos", "Texto")],
                       informes_Tierra_del_Fuego_mas_reciente[,c("Long", "Lat", "Fecha_esp", "Confirmados", "Activos", "Texto")],
                       informes_Rio_Negro_mas_reciente[,c("Long", "Lat", "Fecha_esp", "Confirmados", "Activos", "Texto")],
                       informes_Neuquen_mas_reciente[,c("Long", "Lat", "Fecha_esp", "Confirmados", "Activos", "Texto")]) 


localidades$Confirmados <- as.numeric(paste(localidades$Confirmados))

IND_adm_Arg <- readShapeSpatial("/mnt/28EC75CE33EA541A/temporales/Coronavirus/estadisticas/IGN/SHAPES/argentinaLowADM1_limpio.shp")
proj4string(IND_adm_Arg) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")


IND_adm_Arg$Provincia <- c("CABA","Entre Ríos", "Corrientes","Santa Cruz", "San Luis", "Chubut", "San Juan","Jujuy", "La Rioja","Córdoba","Chaco",
                        "Neuquén", "Formosa",  "Tucumán","Buenos Aires", "Santa Fe", "Santiago del Estero",  "Salta", "Río Negro","Mendoza", "T. del Fuego + Malvinas",
                        "Misiones", "Catamarca", "La Pampa")


IND_adm_Patagonia <- readShapeSpatial("/mnt/28EC75CE33EA541A/temporales/Coronavirus/estadisticas/IGN/SHAPES/argentinaLowADM1_limpio_solo_Patagonia_sin_La_Pampa.shp")
proj4string(IND_adm_Patagonia) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")


IND_adm_Patagonia$Provincia <- c("Santa Cruz", "Chubut", "Neuquén", "Río Negro", "T. del Fuego + Malvinas")  #, "La Pampa"


por_provincia <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1zUECZoe7nM1QcXIgMRMq3OR2Ui_j1EwggAoY2E_88pw/edit?usp=sharing")
por_provincia$Fecha <- as.Date(por_provincia$Fecha, format="%Y/%m/%d")
por_provincia$Fecha_esp <- format(por_provincia$Fecha, "%d/%m/%Y")
por_provincia_mas_reciente  <- por_provincia %>% dplyr::filter(Fecha == max(Fecha))

por_provincia_mas_reciente_transp  <- gather(por_provincia_mas_reciente, Clase, Conteo, -Provincia, -Fecha, -Long, -Lat, -Fuente, -Fecha_esp)
por_provincia_mas_reciente_transp <- por_provincia_mas_reciente_transp  %>% dplyr::filter(Clase != "Confirmados_acum")
#por_provincia_mas_reciente_transp$log_cases <- 2 * log(por_provincia_mas_reciente_transp$Conteo)


IND_adm_Arg <- merge(IND_adm_Arg, por_provincia_mas_reciente, by = "Provincia")

IND_adm_Arg$Texto <- with(IND_adm_Arg, paste0('<p>', IND_adm_Arg$Provincia,'<p></p>',
                                        '<p>',"Confirmados: ", IND_adm_Arg$Confirmados_acum,  '<p></p>',
                                        "Fecha: ", IND_adm_Arg$Fecha_esp,  '</p>'))
                                        #"Fallecidos: ", IND_adm_Arg$Fallecidos_acum,  '</p>',
                                        #'<p>',"Recuperados: ", IND_adm_Arg$Recuperados_acum, '<p></p>',"Activos: ", IND_adm_Arg$Activos_acum,  '</p>'))



paleta_colores <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1y8cgZNJtkaSsKI87S_CxG-QpyJvGAXQZ-VwjFytat7c/edit?usp=sharing")
pal_ap <- colorFactor(paleta_colores$Color_hex, domain = paleta_colores$Provincia) #paleta_colores$Color_hex



IND_adm_Chubut <- readShapeSpatial("/mnt/28EC75CE33EA541A/temporales/Coronavirus/estadisticas/Ministerio_Salud_Chubut/Chubut_poligonos_Areas_programaticas_coronavirus.shp")
proj4string(IND_adm_Chubut) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")

IND_adm_Chubut$Región_larga <- c("Área Programática Comodoro Rivadavia", "Área Programática Esquel", "Área Programática Norte", "Área Programática Trelew")



reportes_Chubut <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1b3NYFb2I9dUyJXmC6OucDTOpns4FQPWGaNt66opjw-A/edit?usp=sharing")
reportes_Chubut$Fecha <- as.Date(reportes_Chubut$Fecha, format = "%d/%m/%Y")
reportes_Chubut$Fecha_esp <- format(reportes_Chubut$Fecha, "%d/%m/%Y")
reportes_Chubut_mas_reciente  <- reportes_Chubut %>% dplyr::filter(Fecha == max(Fecha))
reportes_Chubut_mas_reciente$NOMBRE <- reportes_Chubut_mas_reciente$Región


reportes_Chubut_mas_reciente_transp  <- gather(reportes_Chubut_mas_reciente, Clase, Conteo, -Región, -Fecha, -'Muertes', -'Casos Confirmados')
#reportes_Chubut_mas_reciente_transp <- por_provincia_mas_reciente_transp  %>% dplyr::filter(Clase != "Confirmados_acum")

#reportes_Chubut_mas_reciente_transp <- por_provincia_mas_reciente_transp  %>% dplyr::filter(Clase != "Confirmados_acum")

#unique(reportes_Chubut_mas_reciente_transp$Clase)

IND_adm_Chubut <- merge(IND_adm_Chubut, reportes_Chubut_mas_reciente, by = "NOMBRE")

IND_adm_Chubut$Texto <- with(IND_adm_Chubut, paste0('<p>', IND_adm_Chubut$Región_larga,'<p></p>',
                                        '<p>',"Confirmados: ", IND_adm_Chubut$`Casos Confirmados`,  '<p></p>', "Confirmados fuera de la prov.: ", IND_adm_Chubut$`Casos Confirmados fuera de la provincia`,  '</p>',
                                        "Casos Recuperados: ", IND_adm_Chubut$`Casos Recuperados`,  '</p>',
                                        '<p>',"Casos Sospechosos con Nexo Epidemiológico: ", IND_adm_Chubut$`Casos Sospechosos con Nexo Epidemiológico`, '<p></p>',"Casos Sospechosos IRAG sin Nexo Epidemiológicos: ", IND_adm_Chubut$`Casos Sospechosos IRAG sin Nexo Epidemiológico`,  '</p>',
                                        '<p></p>',
                                        '<p>',"Contactos Estrechos de casos confirmados: ", IND_adm_Chubut$`Contactos Estrechos de casos confirmados`, '<p></p>',"Casos Descartados: ", IND_adm_Chubut$`Casos Descartados`,  '</p>',
                                        '<p>',"Viajeros con Aislamiento Preventivo: ", IND_adm_Chubut$`Viajeros con Aislamiento Preventivo`, '<p></p>',"Viajeros con Aislamiento Preventivo Finalizado: ", IND_adm_Chubut$`Viajeros con Aislamiento Preventivo Finalizado`,  '</p>',"Fecha: ", IND_adm_Chubut$`Fecha_esp`,  '</p>'))



```




País  {data-icon="fas fa-chart-line"}
=======================================================================

Row {data-width=400}
-----------------------------------------------------------------------
### confirmed {.value-box}
  
```{r}
# library(metathis)
# 
# meta() %>%
#   meta_description(
#     "This book will teach you how to do data science with R..."
#   ) %>% 
#   #meta_name("github-repo" = "hadley/r4ds") %>% 
#   meta_viewport() %>% 
#   meta_social(
#     title = "COVID-19 en Patagonia",
#     url = "https://cenpatgisad.github.io/covid19/",
#     image = "https://cenpatgisad.github.io/covid19/cover_pagina_COVID.png",
#     image_alt = "captura de pantalla de la página",
#     og_type = "website",
#     og_author = c("CONICET-CENPAT"),
#     twitter_card_type = "summary",
#     twitter_creator = "@CONICETCenpat"
#   )
  

valueBox(
  value =  paste(format(totales_País_mas_reciente$CasosAcum, big.mark = "."), " (", prettyNum(totales_País_mas_reciente$NuevosCasosDia, big.mark = "."), " nuevos)", "", sep = ""),
  caption = "Total de casos confirmados (en las últimas 24 hs)",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```

### curados {.value-box}

```{r}

valueBox(
  value =  paste(format(totales_País_mas_reciente$Altas_acum, big.mark = ".")),
  caption = "Altas",
  icon = "fas fa-user-check",#far fa-chart-bar
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value =  paste(format(totales_País_mas_reciente$Casos_activos, big.mark = ".")),
  caption = "Casos activos", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-thermometer-full",
  color = active_color
)
```


### death {.value-box}

```{r}
valueBox(
  value = paste(format(totales_País_mas_reciente$FallecAcum, big.mark = "."), " (", totales_País_mas_reciente$NuevosFallec, " nuevos)", "", sep = ""),
  caption = "Fallecidos (en las últimas 24 hs)", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fa-list",
  color = death_color
)

```


Row
-----------------------------------------------------------------------

### **Casos acumulados diarios** (todo el País)
    
```{r}


plotly::plot_ly(data = totales_País) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~CasosAcum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
    plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Casos_activos,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~FallecAcum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Altas_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a español
plotly::layout(
  title = "",
  yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, 
               tickformat = "digit" ### pone en miles y no con k
               #big.mark = "."
               ), #range = c(0,(max(ultimo_resumen_La_Pampa$Confirmados_acum)+10))),
  #xaxis = list(title = "Fecha"),
  xaxis = list(
    type = 'date', 
    fixedrange = TRUE, ### DESABILITA EL ZOOM
    title = "Fuente: <a href=”https://www.argentina.gob.ar/coronavirus/informe-diario” target=”_blank”>Ministerio de Salud Nación</a>"),#,, tickangle=-90, type='category', 
            #ticktext=as.list(informes_Chubut$Fecha_español), 
            #tickvals=as.list(informes_Chubut$Fecha)),#, 
  #tickformat = "%d %B (%a)<br>%Y"),
  legend = list(x = 0.1, y = 0.9),
  hovermode = "compare"
) 
```


### **Sexo y Rango de edad de fallecidos** (todo el País - hasta el 20/07/2020 cuando dejaron de informar la edad de los fallecidos)

```{r}

fig <- plot_ly(fallecidos_Pais_resumen_transp, x = ~Rango_edad_min, y = ~hombre, type = 'bar', name = 'Hombres')
fig <- fig %>% add_trace(y = ~mujer, name = 'Mujeres')
fig <- fig %>% layout(legend = list(x = 0.1, y = 0.9), yaxis = list(title = 'Cantidad de fallecidos', fixedrange = TRUE), xaxis = list(title = 'Rango de edades - Fuente: <a href=”https://www.argentina.gob.ar/coronavirus/informe-diario” target=”_blank”>Ministerio de Salud Nación</a>', barmode = 'stack', tickmode = 'array', tickvals = c(0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100), fixedrange = TRUE,
                                             ticktext = c('0 a 9', '10 a 19', '20 a 29', '30 a 39', '40 a 49', '50 a 59', '60 a 69', '70 a 79', '80 a 89', '90 a 99', '+100')))

fig
```




### **Casos confirmados por día** (todo el País)

```{r}
runmean <- function(x, ventana= 20){
  vr <- x
  rnmn <- rep( NA, length(x) )
  
  for (k in 1:length(vr)){
    rnmn[k] = ifelse(k <= ventana/2, mean(vr[1:(k + ventana/2)]),
                     ifelse( (k + ventana/2)>= length(vr),
                             mean(vr[(k - ventana/2):length(vr)]),
                             mean(vr[(k - ventana/2):(k + ventana/2)]) )
    )
  } # fin calculo media movil
  rnmn
} ## Fin función

totales_País$media_movil_casos_dia <-  runmean(totales_País$NuevosCasosDia, ventana = 5)

plotly::plot_ly(data = totales_País) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~NuevosCasosDia,
    type = 'bar',
    #type = "scatter",
    #mode = "lines+markers",
    name = "Nuevos Confirmados",
    marker = list(color = "#da7be3")) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~media_movil_casos_dia,
    type = "scatter",
    mode = "lines",
    name = "media movil",
    line = list(color = "black", width = 4, shape = "spline")
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a español
  plotly::layout(
  title = "",
  yaxis = list(title = "Nuevos casos confirmados", fixedrange = TRUE), #range = c(0,(max(ultimo_resumen_La_Pampa$Confirmados_acum)+10))),
  xaxis = list(
    type = 'date', 
    fixedrange = TRUE, ### DESABILITA EL ZOOM
    title = "Fuente: <a href=”https://www.argentina.gob.ar/coronavirus/informe-diario” target=”_blank”>Ministerio de Salud Nación</a>"),#,, tickangle=-90, type='category', 
    legend = list(x = 0.1, y = 0.9),
  hovermode = "compare"
) 

```


Row {data-height=350}
-------------------------------------


### **De los casos confirmados:**

```{r}

labels = c('Mujeres','Hombres') ##### {data-width=700, data-height=1000}
values = c(totales_País_mas_reciente$Porc_mujeres_inf, totales_País_mas_reciente$Porc_homb_inf)

fig <- plot_ly(type='pie', labels=labels, values=values, 
               textinfo='label+percent', #label+percent
               insidetextorientation='radial')
fig %>% layout(showlegend = FALSE)
```


### **De los casos confirmados:**
```{r}

labels = c('Importados','Contacto Estrecho', "Circulación comunitaria", "En Investigación") ##### {data-width=700, data-height=1000}
values = c(totales_País_mas_reciente$Importados, totales_País_mas_reciente$Estrechos, totales_País_mas_reciente$circulacion_comunitaria, totales_País_mas_reciente$enInv)

fig <- plot_ly(type='pie', labels=labels, values=values, 
               textinfo='label+percent', #label+percent
               insidetextorientation='radial')

fig %>% layout(showlegend = FALSE)
```


### **De los testeos realizados:**

```{r}
labels = c('Negativos', 'Positivos') ##### {data-width=700, data-height=1000}
values = c((totales_País_mas_reciente$Pruebas_diag - totales_País_mas_reciente$CasosAcum), totales_País_mas_reciente$CasosAcum)

fig <- plot_ly(type='pie', labels=labels, values=values, 
               textinfo='label+percent', #label+percent
               insidetextorientation='radial')
fig %>% layout(showlegend = FALSE)
```


Casos por Provincia  {data-icon="fa-list"}
=======================================================================



### **Casos confirmados acumulados por provincia** *(para ver la figura completa o reiniciar la animación recargue la página en su navegador o pulse sobre la imagen)*


<a href="https://cenpatgisad.github.io/covid19/gganim.gif" target="_blank">
<img src="/mnt/28EC75CE33EA541A/temporales/Coronavirus/testeo_web/Patagonia/gganim.gif" class="img-responsive" height="100%"/>    
</a>




Mapa País  {data-icon="fas fa-map-marked-alt"}
=======================================================================



Row {data-height=800}
-----------------------------------------------------------------------

### **Casos en Argentina** (*use los iconos + y - para acercar / alejar*)

```{r}
### adaptado del ejemplo: https://rstudio.github.io/leaflet/choropleths.html


IND_adm_Arg_CABA_zoom <- readShapeSpatial("/mnt/28EC75CE33EA541A/temporales/Coronavirus/estadisticas/IGN/CABA_ampliado_y_desplazado.shp")
proj4string(IND_adm_Arg_CABA_zoom) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")

IND_adm_Arg_CABA_zoom$Provincia <- c("CABA")


IND_adm_Arg_recuadro_zoom <- readShapeSpatial("/mnt/28EC75CE33EA541A/temporales/Coronavirus/estadisticas/IGN/CABA_linea_remarca_area.shp")
proj4string(IND_adm_Arg_recuadro_zoom) <- CRS("+proj=longlat +ellps=WGS84 +datum=WGS84")

IND_adm_Arg_CABA_zoom <- merge(IND_adm_Arg_CABA_zoom, por_provincia_mas_reciente[por_provincia_mas_reciente$Provincia=="CABA",], by = "Provincia")

IND_adm_Arg_CABA_zoom$Texto <- with(IND_adm_Arg_CABA_zoom, paste0('<p>', IND_adm_Arg_CABA_zoom$Provincia,'<p></p>',
                                        '<p>',"Confirmados: ", IND_adm_Arg_CABA_zoom$Confirmados_acum,  '<p></p>', 
                                        "Fecha: ", IND_adm_Arg_CABA_zoom$Fecha_esp,  '</p>'))


library(leaflet)
paleta_colores <- gsheet2tbl("https://docs.google.com/spreadsheets/d/1y8cgZNJtkaSsKI87S_CxG-QpyJvGAXQZ-VwjFytat7c/edit?usp=sharing")
pal_ap <- colorFactor(paleta_colores$Color_hex, domain = paleta_colores$Provincia) #paleta_colores$Color_hex


bins <- c(0, 1, 10, 50, 100, 500, 1000, 2000, 5000, 10000, 200000)
pal <- colorBin("YlOrRd", domain = IND_adm_Arg$Confirmados_acum, bins = bins)

#str(IND_adm_Arg@data)

mapa_Arg <- leaflet()  %>% addProviderTiles(providers$Stamen.TerrainBackground) %>% #OpenStreetMap
  addPolygons(data=IND_adm_Arg, 
              fillColor = ~pal(Confirmados_acum),
              weight = 1,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(
                weight = 5,
                color = "#666",
                dashArray = "",
                fillOpacity = 0.7,
                bringToFront = TRUE),
              #color= ~pal_ap(Provincia), 
              label = lapply(IND_adm_Arg$Texto, htmltools::HTML),
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "12px",
                direction = "auto"))   %>% 
  addPolygons(data=IND_adm_Arg_CABA_zoom, 
              fillColor = ~pal(Confirmados_acum),
              weight = 2,
              opacity = 1,
              color = "white",
              dashArray = "3",
              fillOpacity = 0.7,
              highlight = highlightOptions(
                weight = 5,
                color = "#666",
                dashArray = "",
                fillOpacity = 0.7,
                bringToFront = TRUE),
              #color= ~pal_ap(Provincia), 
              label = lapply(IND_adm_Arg_CABA_zoom$Texto, htmltools::HTML),
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "12px",
                direction = "auto")) %>% 
  addPolylines(data=IND_adm_Arg_recuadro_zoom,color = "black", weight = 1)

mapa_Arg %>% addLegend(pal = pal, values = IND_adm_Arg$Confirmados_acum, opacity = 0.7, title = "Casos confirmados",
                                                    position = "bottomright")



```







Prov. Patagónicas  {data-icon="fas fa-chart-line"}
=======================================================================



Row
-------------------------------------
### provincia {.value-box}

```{r}


valueBox(
  value = paste("Chubut"),
  caption = paste("Última actualización: ", ultimo_resumen_Chubut$Ultima_act, sep = ""),
  icon = "fas fa-shield-virus",
  color = "primary"
)
```

### tiempo_duplicacion {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(round(tiempo_duplicacion_Chubut,1), decimal.mark = ",")),#paste(format(round(tiempo_duplicacion_Chubut,1), nsmall = 1, decimal.mark = ",")), #
  caption = "Tiempo de duplicación (días)",
  icon = "fas fa-hourglass-half", #fas fa-stethoscope
  color ="primary"
)
```




Row {width = 100%}
-------------------------------------
  
  
### confirmed {.value-box}
  
```{r}


valueBox(
  value = paste(format(ultimo_resumen_Chubut$Confirmados_acum, big.mark = ","), "", sep = " "),
  caption = "Total de casos confirmados",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```


### curados {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Chubut$Curados_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteChubut / casos_confirmadosChubut, 1),
                #"%)",
                sep = ""
  ),
  caption = "Altas", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-user-check",
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Chubut$Activos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteChubut / casos_confirmadosChubut, 1),
                #"%)",
                sep = ""
  ),
  caption = "Casos activos",
  icon = "fas fa-thermometer-full",
  color = active_color
)
```



### death {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Chubut$Fallecidos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteChubut / casos_confirmadosChubut, 1),
                #"%)",
                sep = ""
  ),
  caption = "Fallecidos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "fa-list",
  color = death_color
)
```


### sopechosos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Chubut$Sospechosos, big.mark = "."), #" (",
                #round(100 * casos_muerteChubut / casos_confirmadosChubut, 1),
                #"%)",
                sep = ""
  ),
  caption = "Sospechosos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "far fa-bell",
  color = "#E69F00"
)
```



Row {width = 100%}
-------------------------------------
  
### **Casos acumulados diarios** (solo Chubut)
  
```{r}



plotly::plot_ly(data = resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Chubut",]) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Confirmados_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Activos_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Fallecidos_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Curados_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a españo
  plotly::layout(
    title = "",
    yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, range = c(0,(max(ultimo_resumen_Chubut$Confirmados_acum)+ 0.2*max(ultimo_resumen_Chubut$Confirmados_acum)))),
    #xaxis = list(title = "Fecha"),
    xaxis = list(
      type = 'date',
      fixedrange = TRUE,
      title = "Fuente: <a href=”http://www.ministeriodesalud.chubut.gov.ar/ministerio-de-salud/epidemiologia/coronavirus-personal-salud/” target=”_blank”>Ministerio de Salud Gobierno de Chubut</a>"),#,, tickangle=-90, type='category', 
    #ticktext=as.list(informes_Chubut$Fecha_español), 
    #tickvals=as.list(informes_Chubut$Fecha)),#, 
    #tickformat = "%d %B (%a)<br>%Y"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "compare"
  ) 
```




Row
-------------------------------------
### provincia {.value-box}
  
```{r}


valueBox(
  value = paste("Neuquén"),
  caption = paste("Última actualización: ", ultimo_resumen_Neuquen$Ultima_act, sep = ""),
  icon = "fas fa-shield-virus",
  color = "primary"
)
```

### tiempo_duplicacion {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(round(as.numeric(tiempo_duplicacion_Neuquen),1), decimal.mark = ",")),
  caption = "Tiempo de duplicación (días)",
  icon = "fas fa-hourglass-half", #fas fa-stethoscope
  color ="primary"
)
```



Row {width = 100%}
-------------------------------------
  
  
### confirmed {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(ultimo_resumen_Neuquen$Confirmados_acum, big.mark = "."), "", sep = " "),
  caption = "Total de casos confirmados",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```


### curados {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Neuquen$Curados_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteNeuquen / casos_confirmadosNeuquen, 1),
                #"%)",
                sep = ""
  ),
  caption = "Altas", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-user-check",
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Neuquen$Activos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteNeuquen / casos_confirmadosNeuquen, 1),
                #"%)",
                sep = ""
  ),
  caption = "Casos activos",
  icon = "fas fa-thermometer-full",
  color = active_color
)
```



### death {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Neuquen$Fallecidos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteNeuquen / casos_confirmadosNeuquen, 1),
                #"%)",
                sep = ""
  ),
  caption = "Fallecidos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "fa-list",
  color = death_color
)
```


### sopechosos {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Neuquen$Sospechosos, big.mark = "."), #" (",
                #round(100 * casos_muerteNeuquen / casos_confirmadosNeuquen, 1),
                #"%)",
                sep = ""
  ),
  caption = "Sospechosos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "far fa-bell",
  color = "#E69F00"
)
```



Row {width = 100%}
-------------------------------------
  
### **Casos acumulados diarios** (solo Neuquén)
  
```{r}



plotly::plot_ly(data = resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Neuquén",]) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Confirmados_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Activos_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Fallecidos_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Curados_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a españo
  plotly::layout(
    title = "",
    yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, range = c(0,(max(ultimo_resumen_Neuquen$Confirmados_acum)+ 0.2*max(ultimo_resumen_Neuquen$Confirmados_acum)))),
    #xaxis = list(title = "Fecha"),
    xaxis = list(
      type = 'date', fixedrange = TRUE,
      title = "Fuente: <a href=”https://www.saludneuquen.gob.ar/” target=”_blank”>Ministerio de Salud Gobierno de Neuquén</a>"),#,, tickangle=-90, type='category', 
    #ticktext=as.list(informes_Chubut$Fecha_español), 
    #tickvals=as.list(informes_Chubut$Fecha)),#, 
    #tickformat = "%d %B (%a)<br>%Y"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "compare"
  ) 
```










Row
-------------------------------------
### provincia {.value-box}
  
```{r}


valueBox(
  value = paste("Río Negro"),
  caption = paste("Última actualización: ", ultimo_resumen_Río_Negro$Ultima_act, sep = ""),
  icon = "fas fa-shield-virus",
  color = "primary"
)
```


### tiempo_duplicacion {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(round(tiempo_duplicacion_Rio_Negro,1), decimal.mark = ",")),
  caption = "Tiempo de duplicación (días)",
  icon = "fas fa-hourglass-half", #fas fa-stethoscope
  color ="primary"
)
```




Row {width = 100%}
-------------------------------------
  
  
### confirmed {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(ultimo_resumen_Río_Negro$Confirmados_acum, big.mark = "."), "", sep = " "),
  caption = "Total de casos confirmados",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```


### curados {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Río_Negro$Curados_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteRío_Negro / casos_confirmadosRío_Negro, 1),
                #"%)",
                sep = ""
  ),
  caption = "Altas", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-user-check",
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Río_Negro$Activos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteRío_Negro / casos_confirmadosRío_Negro, 1),
                #"%)",
                sep = ""
  ),
  caption = "Casos activos",
  icon = "fas fa-thermometer-full",
  color = active_color
)
```



### death {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Río_Negro$Fallecidos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteRío_Negro / casos_confirmadosRío_Negro, 1),
                #"%)",
                sep = ""
  ),
  caption = "Fallecidos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "fa-list",
  color = death_color
)
```


### sopechosos {.value-box}

```{r}

valueBox(
  value = paste(prettyNum(ultimo_resumen_Río_Negro$Sospechosos, big.mark = "."), #" (",
                #round(100 * casos_muerteRío_Negro / casos_confirmadosRío_Negro, 1),
                #"%)",
                sep = ""
  ),
  caption = "Sospechosos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "far fa-bell",
  color = "#E69F00"
)
```



Row {width = 100%}
-------------------------------------
  
### **Casos acumulados diarios** (solo Río Negro)
  
```{r}



plotly::plot_ly(data = resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Río Negro",]) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Confirmados_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Activos_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Fallecidos_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Curados_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a españo
  plotly::layout(
    title = "",
    yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, range = c(0,(max(ultimo_resumen_Río_Negro$Confirmados_acum)+ 0.2*max(ultimo_resumen_Río_Negro$Confirmados_acum)))),
    #xaxis = list(title = "Fecha"),
    xaxis = list(
      type = 'date', fixedrange = TRUE,
      title = "Fuente: <a href=”https://www.rionegro.gov.ar/index.php?catID=17” target=”_blank”>Ministerio de Salud Gobierno de Río Negro</a>"),#,, tickangle=-90, type='category', 
    #ticktext=as.list(informes_Chubut$Fecha_español), 
    #tickvals=as.list(informes_Chubut$Fecha)),#, 
    #tickformat = "%d %B (%a)<br>%Y"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "compare"
  ) 
```

          



Row
-------------------------------------
### provincia {.value-box}
  
```{r}


valueBox(
  value = paste("Santa Cruz"),
  caption = paste("Última actualización: ", ultimo_resumen_Santa_Cruz$Ultima_act, sep = ""),
  icon = "fas fa-shield-virus",
  color = "primary"
)
```


### tiempo_duplicacion {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(round(tiempo_duplicacion_SantaCruz[[1]],1), decimal.mark = ",")),#paste(format(round(tiempo_duplicacion_Chubut,1), nsmall = 1, decimal.mark = ",")), #
  caption = "Tiempo de duplicación (días)",
  icon = "fas fa-hourglass-half", #fas fa-stethoscope
  color ="primary"
)
```



Row {width = 100%}
-------------------------------------
  
  
### confirmed {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(ultimo_resumen_Santa_Cruz$Confirmados_acum, big.mark = "."), "", sep = " "),#paste(format(ultimo_resumen_Santa_Cruz$Confirmados_acum, big.mark = ","), "", sep = " "),
  caption = "Total de casos confirmados",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```


### curados {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Santa_Cruz$Curados_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteSanta_Cruz / casos_confirmadosSanta_Cruz, 1),
                #"%)",
                sep = ""
  ),
  caption = "Altas", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-user-check",
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Santa_Cruz$Activos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteSanta_Cruz / casos_confirmadosSanta_Cruz, 1),
                #"%)",
                sep = ""
  ),
  caption = "Casos activos",
  icon = "fas fa-thermometer-full",
  color = active_color
)
```



### death {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Santa_Cruz$Fallecidos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteSanta_Cruz / casos_confirmadosSanta_Cruz, 1),
                #"%)",
                sep = ""
  ),
  caption = "Fallecidos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "fa-list",
  color = death_color
)
```


### sopechosos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Santa_Cruz$Sospechosos, big.mark = "."), #" (",
                #round(100 * casos_muerteSanta_Cruz / casos_confirmadosSanta_Cruz, 1),
                #"%)",
                sep = ""
  ),
  caption = "Sospechosos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "far fa-bell",
  color = "#E69F00"
)
```



Row {width = 100%}
-------------------------------------
  
### **Casos acumulados diarios** (solo Santa Cruz)

```{r}



plotly::plot_ly(data = resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Santa Cruz",]) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Confirmados_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Activos_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Fallecidos_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Curados_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a españo
  plotly::layout(
    title = "",
    yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, range = c(0,(max(ultimo_resumen_Santa_Cruz$Confirmados_acum)+ 0.2*max(ultimo_resumen_Santa_Cruz$Confirmados_acum)))),
    #xaxis = list(title = "Fecha"),
    xaxis = list(
      type = 'date', fixedrange = TRUE,
      title = "Fuente: <a href=”http://saludsantacruz.gob.ar/portal/category/noticias/” target=”_blank”>Ministerio de Salud Gobierno de Santa Cruz</a>"),#,, tickangle=-90, type='category', 
    #ticktext=as.list(informes_Chubut$Fecha_español), 
    #tickvals=as.list(informes_Chubut$Fecha)),#, 
    #tickformat = "%d %B (%a)<br>%Y"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "compare"
  ) 
```


Row
-------------------------------------
### provincia {.value-box}
  
```{r}


valueBox(
  value = paste("Tierra del Fuego"),
  caption = paste("Última actualización: ", ultimo_resumen_Tierra_del_Fuego$Ultima_act, sep = ""),
  icon = "fas fa-shield-virus",
  color = "primary"
)
```

### tiempo_duplicacion {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(round(tiempo_duplicacion_TierraDelFuego[[1]],1), decimal.mark = ",")),#paste(format(round(tiempo_duplicacion_Chubut,1), nsmall = 1, decimal.mark = ",")), #
  caption = "Tiempo de duplicación (días)",
  icon = "fas fa-hourglass-half", #fas fa-stethoscope
  color ="primary"
)
```


Row {width = 100%}
-------------------------------------
  
  
### confirmed {.value-box}
  
```{r}


valueBox(
  value = paste(prettyNum(ultimo_resumen_Tierra_del_Fuego$Confirmados_acum, big.mark = "."), "", sep = " "),#paste(format(ultimo_resumen_Tierra_del_Fuego$Confirmados_acum, big.mark = ","), "", sep = " "),
  caption = "Total de casos confirmados",
  icon = "fas fa-stethoscope", #fas fa-stethoscope
  color = confirmed_color
)
```


### curados {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Tierra_del_Fuego$Curados_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteTierra_del_Fuego / casos_confirmadosTierra_del_Fuego, 1),
                #"%)",
                sep = ""
  ),
  caption = "Altas", # (tasa de mortalidad [100*Casos de muerte/Casos confirmados])
  icon = "fas fa-user-check",
  color = recovered_color
)
```


### activos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Tierra_del_Fuego$Activos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteTierra_del_Fuego / casos_confirmadosTierra_del_Fuego, 1),
                #"%)",
                sep = ""
  ),
  caption = "Casos activos",
  icon = "fas fa-thermometer-full",
  color = active_color
)
```



### death {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Tierra_del_Fuego$Fallecidos_acum, big.mark = "."), #" (",
                #round(100 * casos_muerteTierra_del_Fuego / casos_confirmadosTierra_del_Fuego, 1),
                #"%)",
                sep = ""
  ),
  caption = "Fallecidos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "fa-list",
  color = death_color
)
```


### sopechosos {.value-box}

```{r}

valueBox(
  value = paste(format(ultimo_resumen_Tierra_del_Fuego$Sospechosos, big.mark = "."), #" (",
                #round(100 * casos_muerteTierra_del_Fuego / casos_confirmadosTierra_del_Fuego, 1),
                #"%)",
                sep = ""
  ),
  caption = "Sospechosos", # (tasa de mortalidad [100*Fallecidos/Casos confirmados])
  icon = "far fa-bell",
  color = "#E69F00"
)
```



Row {width = 100%}
-------------------------------------
  
### **Casos acumulados diarios** (solo Tierra del Fuego)
  
```{r}



plotly::plot_ly(data = resumenes_diarios_prov_Pat[resumenes_diarios_prov_Pat$Provincia=="Tierra del Fuego y Malvinas",]) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Confirmados_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Confirmados",
    line = list(color = confirmed_color),
    marker = list(color = confirmed_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    # y = ~active_cum,
    y = ~Activos_acum,
    type = "scatter",
    mode = "lines+markers",
    # name = "Active",
    name = "Activos",
    line = list(color = active_color),
    marker = list(color = active_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Fallecidos_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Fallecidos",
    line = list(color = death_color),
    marker = list(color = death_color)
  ) %>%
  plotly::add_trace(
    x = ~Fecha,
    y = ~Curados_acum,
    type = "scatter",
    mode = "lines+markers",
    name = "Curados",
    line = list(color = recovered_color),
    marker = list(color = recovered_color)
  ) %>%
  plotly::add_annotations(
    x = as.Date("2020-03-03"),
    y = 0.1,
    text = paste("Primer caso<br>en Argentina"),
    xref = "x",
    yref = "y",
    arrowhead = 5,
    arrowhead = 3,
    arrowsize = 1,
    showarrow = TRUE,
    ax = 2,
    ay = -70
  ) %>%
  config(locale = 'es-ar') %>%  #### cambia el idioma de la fecha a españo
  plotly::layout(
    title = "",
    yaxis = list(title = "Número acumulado de casos", fixedrange = TRUE, range = c(0,(max(ultimo_resumen_Tierra_del_Fuego$Confirmados_acum)+ 0.2*max(ultimo_resumen_Tierra_del_Fuego$Confirmados_acum)))),
    #xaxis = list(title = "Fecha"),
    xaxis = list(
      type = 'date', fixedrange = TRUE,
      title = "Fuente: <a href=”https://www.tierradelfuego.gob.ar/category/coronavirus/” target=”_blank”>Ministerio de Salud Gobierno de Tierra del Fuego</a>"),#,, tickangle=-90, type='category', 
    #ticktext=as.list(informes_Chubut$Fecha_español), 
    #tickvals=as.list(informes_Chubut$Fecha)),#, 
    #tickformat = "%d %B (%a)<br>%Y"),
    legend = list(x = 0.1, y = 0.9),
    hovermode = "compare"
  ) 
```




Mapa Patagonia  {data-icon="fas fa-map-marked-alt"}
=======================================================================


Row {data-height=800}
-----------------------------------------------------------------------

### **Casos en Patagonia** (*use los iconos + y - para acercar / alejar*)

```{r}
### adaptado del ejemplo: https://rstudio.github.io/leaflet/choropleths.html



bins <- c(0, 1, 5, 10, 20, 50, 100, 200, 500, 1000)
pal <- colorBin("YlOrRd", domain = IND_adm_Arg$Confirmados_acum, bins = bins)
# bins <- c(0, 1, 10, 20, 50, 100, 150)
# pal <- colorBin("Purples", domain = IND_adm_Chubut$`Casos Confirmados`, bins = bins) #YlOrRd

#str(IND_adm_Chubut@data)

pal2 <- colorFactor(c("orange", "red", "blue"), domain = c("Activos", "Fallecidos", "Sospechosos"))

localidades_conf <- localidades[localidades$Confirmados>0,]
localidades_act <- localidades[localidades$Activos>0,]

mapa_Chubut <- leaflet() %>% addProviderTiles(providers$Esri.WorldStreetMap) %>% #Stamen.TerrainBackground  OpenStreetMap Esri.WorldGrayCanvas   http://leaflet-extras.github.io/leaflet-providers/preview/
  addMapPane("poligonos_Chubut", zIndex = 410) %>% # shown below ames_circles
  addMapPane("localidades", zIndex = 420) %>% # shown above ames_lines
  addPolygons(data=IND_adm_Patagonia, 
              weight = 1,
              opacity = 1,
              color = "black", 
              dashArray = "3",
              fillOpacity = 0.0,
              #highlight = highlightOptions(
              #  weight = 5,
              #  color = "#666",
              #  dashArray = "",
              #  fillOpacity = 0.7,
              #  bringToFront = TRUE),
              #color= ~pal_ap(Provincia), 
              #label = lapply(IND_adm_Arg$Texto, htmltools::HTML),
              #labelOptions = labelOptions(
              #  style = list("font-weight" = "normal", padding = "3px 8px"),
              #  textsize = "10px",
              #  direction = "auto")
              ) %>% 
            addPolygons(data=IND_adm_Chubut,
              fillColor = ~pal(`Casos Confirmados`),
              options = pathOptions(pane = "poligonos_Chubut"), ###para darle el orede de las capas
              weight = 2,
              opacity = 1,
              color = "black",
              dashArray = "3",
              fillOpacity = 0.3,
              highlight = highlightOptions(
                weight = 5,
                color = "#666",
                dashArray = "",
                fillOpacity = 0.7,
                bringToFront = TRUE),
              #color= ~pal_ap(Provincia), 
              label = lapply(IND_adm_Chubut$Texto, htmltools::HTML),
              labelOptions = labelOptions(
                style = list("font-weight" = "normal", padding = "3px 8px"),
                textsize = "11px",
                 direction = "auto"))  %>% 
            addCircleMarkers(data = localidades_conf,
                             lng= ~Long,
                              lat= ~Lat,
                             options = pathOptions(pane = "localidades"),
                    popup = ~Confirmados,
                    stroke = TRUE,
                    color = "black",
                    #radius = 3,#~ifelse(Confirmados > 20, 22, Confirmados),
                    fillColor = ~pal(`Confirmados`),
                    label = lapply(localidades_conf$Texto, htmltools::HTML),
                    #fillColor = ~pal(OCD_Program),
                    fillOpacity = 0.9,
                    group = "<em>Casos Confirmados</em>",
                      #clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = F),
                    labelOptions = labelOptions(noHide = F, textsize = "11px",direction = "auto"))%>% 
            addCircleMarkers(data = localidades_act,
                             lng= ~Long,
                              lat= ~Lat,
                             options = pathOptions(pane = "localidades"),
                    popup = ~Activos,
                    stroke = TRUE,
                    color = "black",
                    #radius = 3,#~ifelse(Confirmados > 20, 22, Confirmados),
                    fillColor = ~pal(`Activos`),
                    label = lapply(localidades_act$Texto, htmltools::HTML),
                    #fillColor = ~pal(OCD_Program),
                    fillOpacity = 0.9,
                    group = "<em>Casos Activos</em>",
                      #clusterOptions = markerClusterOptions(removeOutsideVisibleBounds = F),
                    labelOptions = labelOptions(noHide = F, textsize = "11px",direction = "auto"))
            

 mapa_Chubut %>% addLegend(pal = pal, values = IND_adm_Chubut$Confirmados_acum, opacity = 0.7, title = "Casos", #%>%  addMiniMap(tiles = providers$Esri.WorldStreetMap, width = 120, height=80)
                       position = "topright")   %>%
 addLayersControl(
    baseGroups = c("<em>Casos Confirmados</em>", "<em>Casos Activos</em>"),
        options = layersControlOptions(collapsed = FALSE))
```







Información útil  {data-icon="fas fa-info-circle"}
=======================================================================

**Síntomas**

* Fiebre (37.5º o más)
* Tos seca
* Dolor de garganta
* En algunos casos pérdida temporal de olfato y gusto
* En algunos casos dolores musculares, congestión nasal o diarrea


&nbsp;
**Medidas de prevención**

* Respetar el aislamiento social preventivo y obligatorio.
* Distanciamiento social (más de un metro de distancia entre personas).
* Lavarse las manos con frecuencia utilizando agua y jabón.
* Solo en ocasiones en donde no tenés acceso a agua y jabón, utilizar alcohol en gel.
* Toser o estornudar en el pliegue del codo. 
* No llevarse las manos a los ojos, nariz o boca.
* Desinfectar objetos provenientes de fuera de casa con una dilución de alcohol (alcohol 70%, aproximadamente 2 partes de alcohol y 1 de agua).
* Limpiar periódicamente pisos y superficies con agua y lavandina (dilución 10 ml de lavandina por litro de agua, o aproximadamente 1/2 pocillo de café de lavandina comercial de 25g/L, en un balde de agua). Recordá que las superficies deben estar limpias para luego ser desinfectadas. 
* Se recomienda el uso de cubre boca y nariz para aquellos que necesiten salir de casa. Para realizar un tapabocas desde casa visitá este <a href="https://patagonianorte.conicet.gov.ar/wp-content/uploads/sites/79/2020/04/Material-General-Mascarillas-IPATEC.pdf" target="_blank">link</a>.
    
    
En caso de tener alguno de los síntomas de Coronavirus **NO ASISTAS A LA GUARDIA DEL HOSPITAL**, comunicate al **0800-222-2676 (CORO)** o al **0800-222-1002**. 
Solo para emergencias en la provincia de Chubut comunicate al **107**.
Si durante el aislamiento obligatorio necesitás orientación profesional y contención en salud mental podes llamar: 

* Puerto Madryn: Lunes a Viernes de 8:00 a 20:00 hs. al (0280) 5066107 o mandar un email a saludmentalpm@gmail.com indicando tu nombre, DNI y número de teléfono para que te contacten.
* Comodoro Rivadavia: Lunes a Viernes de 8:00 a 20:00 hs. al (0297) 4062030.
* Trelew y Rawson: Lunes a Viernes de 8:00 a 20:00 hs. al (0280) 4630045.
* Esquel: Lunes a Viernes de 8:00 a 16:00 hs. al (02945) 647284.


&nbsp;

Recordá informarte siempre a través de medios oficiales. En estos enlaces encontrarás información adicional:  

* <a href="http://www.ministeriodesalud.chubut.gov.ar/ministerio-de-salud/epidemiologia/coronavirus/" target="_blank">Ministerio de Salud Gobierno del Chubut</a>
* <a href="https://www.argentina.gob.ar/salud/coronavirus-COVID-19" target="_blank">Argentina.gob.ar</a>


&nbsp;

**Sitios importantes**

<iframe src="https://www.google.com/maps/d/embed?mid=1QXRzxB8AKa8_P-WbBzv9nsaobqM6-8j5&z=5&ll=-43.86, -68.47" width="300" height="300"></iframe>



Sobre esta página  {data-icon="fas fa-caret-up"}
=======================================================================


**Bases de datos**


Los datos analizados en este enlace fueron obtenidos y son actualizados con información proveniente de los informes diarios realizados por el Ministerio de Salud de <a href="https://www.argentina.gob.ar/coronavirus/informe-diario" target="_blank">Nación</a> y de los reportes diarios provinciales generados por el Ministerio de Salud de la Provincia de <a href="http://www.ministeriodesalud.chubut.gov.ar/ministerio-de-salud/epidemiologia/coronavirus-personal-salud/" target="_blank">Chubut</a>, <a href="http://saludsantacruz.gob.ar/portal/category/noticias/" target="_blank">Santa Cruz</a>, <a href="https://www.saludneuquen.gob.ar/" target="_blank">Neuquén</a>, <a href="http://www.salud.lapampa.gov.ar/Coronavirus_reportes.asp?id=covid19rp" target="_blank">La Pampa</a>, <a href="https://prensa.rionegro.gov.ar/" target="_blank">Río Negro</a> y <a href="https://www.tierradelfuego.gob.ar/category/coronavirus/" target="_blank">Tierra del Fuego, Antártida e Islas del Atlántico Sur</a>.



&nbsp;


**Coordinador**

Dr. <a href="https://www.conicet.gov.ar/new_scp/detalle.php?id=25918&keywords=julio+lancelotti&datos_academicos=yes" target="_blank">Julio Lancelotti</a> - Instituto Patagónico para el Estudio de los Ecosistemas Continentales <a href="https://ipeec.conicet.gov.ar/" target="_blank">IPEEC</a>  CCT CONICET-CENPAT
&nbsp;

Contacto: julio@cenpat-conicet.gob.ar



**Grupo de Trabajo**

Lic. <a href="https://www.conicet.gov.ar/new_scp/detalle.php?id=39616&keywords=bandieri&datos_academicos=yes" target="_blank">Lucas Bandieri</a>
 - Instituto Patagónico de Ciencias Sociales y Humanas <a href="https://ipcsh.conicet.gov.ar/" target="_blank">IPCSH</a> CCT CONICET-CENPAT


Ing. <a href="https://www.conicet.gov.ar/new_scp/detalle.php?id=50913&keywords=Ivana+Gonz%C3%A1lez+Bagur&datos_academicos=yes" target="_blank">Ivana González Bagur</a> 
 - Instituto Patagónico de Ciencias Sociales y Humanas <a href="https://ipcsh.conicet.gov.ar/" target="_blank">IPCSH</a> CCT CONICET-CENPAT

Dra. <a href="https://www.conicet.gov.ar/new_scp/detalle.php?id=54904&keywords=Noela+S%C3%A1nchez+Carnero&datos_academicos=yes" target="_blank">Noela Sánchez Carnero</a>  - Centro para el Estudio de los Sistemas Marinos <a href="https://cenpat.conicet.gov.ar/cesimar/" target="_blank">CESIMAR</a> CCT CONICET-CENPAT

Dra. <a href="https://ri.conicet.gov.ar/author/16078" target="_blank">Luciana Pozzi</a>
 - Universidad Nacional de la Patagonia San Juan Bosco. Facultad de Ciencias Naturales y Ciencias de la Salud - Sede Puerto Madryn (<a href="http://www.unp.edu.ar/" target="_blank">UNPSJB</a>) / Centro para el Estudio de los Sistemas Marinos <a href="https://cenpat.conicet.gov.ar/cesimar/" target="_blank">CESIMAR</a> CCT CONICET-CENPAT

Dra. <a href="https://www.conicet.gov.ar/new_scp/detalle.php?id=41671&keywords=%22Gabriela+Blanco%22&datos_academicos=yes" target="_blank">Gabriela Blanco</a> 
 - Instituto de Biología de Organismos Marinos <a href="https://ibiomar.conicet.gov.ar/" target="_blank">IBIOMAR</a> CCT CONICET-CENPAT



